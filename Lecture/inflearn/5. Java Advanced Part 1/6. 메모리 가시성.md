# 6. ë©”ëª¨ë¦¬ ê°€ì‹œì„±



## 1. ì˜ˆìƒê³¼ ì‹¤ì œê°€ ë‹¤ë¥¸ ê²°ê³¼: `volatile` ì—†ì´ ë°œìƒí•˜ëŠ” ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œ

**ì‹¤í—˜ ì‹œë‚˜ë¦¬ì˜¤: `runFlag`ë¡œ ìŠ¤ë ˆë“œ ì¢…ë£Œ ì œì–´**

```java
package thread.volatile1;

import static util.MyLogger.log;
import static util.ThreadUtils.sleep;

public class VolatileFlagMain {

  public static void main(String[] args) {
    MyTask task = new MyTask();
    Thread t = new Thread(task, "work");
    log("runFlag = " + task.runFlag);
    t.start();

    sleep(1000);
    log("runFlagë¥¼ falseë¡œ ë³€ê²½ ì‹œë„");
    task.runFlag = false;
    log("runFlag = " + task.runFlag);
    log("main ì¢…ë£Œ");
  }

  static class MyTask implements Runnable {
    boolean runFlag = true; // ë¬´í•œ ëŒ€ê¸° ë°œìƒ!
//    volatile boolean runFlag = true;

    @Override
    public void run() {
      log("task ì‹œì‘");
      while (runFlag) {
        // runFlagê°€ falseë¡œ ë³€í•˜ë©´ íƒˆì¶œ
      }
      log("task ì¢…ë£Œ");
    }
  }
}
```

```java
12:40:50.608 [     main] runFlag = true
12:40:50.612 [     work] task ì‹œì‘
12:40:51.617 [     main] runFlagë¥¼ falseë¡œ ë³€ê²½ ì‹œë„
12:40:51.618 [     main] runFlag = false
12:40:51.618 [     main] main ì¢…ë£Œ
```

- `main` ìŠ¤ë ˆë“œê°€ `runFlag = false`ë¡œ ë³€ê²½í•˜ë©´, `work` ìŠ¤ë ˆë“œëŠ” ì´ë¥¼ ê°ì§€í•´ while ë¬¸ì„ íƒˆì¶œí•´ì•¼ í•©ë‹ˆë‹¤.



**ê¸°ëŒ€í•œ ì‹¤í–‰ íë¦„**

```vb
main: runFlag = false
â†’ work: runFlag ê°ì§€ â†’ "task ì¢…ë£Œ"
â†’ í”„ë¡œê·¸ë¨ ì •ìƒ ì¢…ë£Œ
```



**ì‹¤ì œ ê²°ê³¼**

```vb
main: runFlag = false
â†’ work: ì—¬ì „íˆ true ì½ìŒ â†’ ë°˜ë³µë¬¸ ë¬´í•œ ì‹¤í–‰
â†’ "task ì¢…ë£Œ" ì¶œë ¥ë˜ì§€ ì•ŠìŒ
â†’ í”„ë¡œê·¸ë¨ ì¢…ë£Œë˜ì§€ ì•ŠìŒ
```

------

**ì›ì¸: ë©”ëª¨ë¦¬ ê°€ì‹œì„±(Memory Visibility) ë¬¸ì œ**

- ê° CPU ì½”ì–´ëŠ” **ë…ë¦½ëœ ìºì‹œ ë©”ëª¨ë¦¬**ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
- `runFlag`ëŠ” ì²˜ìŒì—” ë©”ì¸ ë©”ëª¨ë¦¬ â†’ ì´í›„ì—” ê°ìì˜ **ìºì‹œ ë©”ëª¨ë¦¬ì—ì„œë§Œ ì½ìŠµë‹ˆë‹¤.**
- `main` ìŠ¤ë ˆë“œê°€ `false`ë¡œ ë°”ê¿”ë„, `work` ìŠ¤ë ˆë“œëŠ” ìì‹ ì˜ **ìºì‹œëœ ê°’(true)**ë§Œ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ë³€ê²½ì„ ê°ì§€í•˜ì§€ ëª»í•©ë‹ˆë‹¤.



**í•µì‹¬ ê·¸ë¦¼ ìš”ì•½**

| êµ¬ì„±        | ì„¤ëª…                                         |
| ----------- | -------------------------------------------- |
| main ìŠ¤ë ˆë“œ | runFlag = false (ìºì‹œ 1ì— ì ìš©)              |
| work ìŠ¤ë ˆë“œ | runFlag = true (ìºì‹œ 2ì—ì„œ ê³„ì† true ì½ìŒ)   |
| ë©”ì¸ ë©”ëª¨ë¦¬ | ë³€ê²½ì´ ë°˜ì˜ë˜ì§€ ì•Šê±°ë‚˜, ë™ê¸°í™”ë˜ì§€ ì•ŠìŒ      |
| ê²°ê³¼        | `work` ìŠ¤ë ˆë“œëŠ” ê³„ì† trueë¡œ ì¸ì‹ â†’ ë¬´í•œ ë£¨í”„ |



**ì •ë¦¬**

- `boolean runFlag = true;`ë§Œìœ¼ë¡œëŠ” ìŠ¤ë ˆë“œ ê°„ ë³€ê²½ì´ **ì¦‰ì‹œ ë³´ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
- **ë™ê¸°í™”ëœ ì ‘ê·¼ ë˜ëŠ” `volatile` í‚¤ì›Œë“œ**ê°€ í•„ìš”í•©ë‹ˆë‹¤.





## 2. `volatile` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë³´ì¥

**í•´ê²° ì „ëµ: `volatile` í‚¤ì›Œë“œ ì‚¬ìš©**

```java
volatile boolean runFlag = true;
```

- `volatile`ì„ ë¶™ì´ë©´, í•´ë‹¹ ë³€ìˆ˜ëŠ” **í•­ìƒ ë©”ì¸ ë©”ëª¨ë¦¬ë¡œë¶€í„° ì§ì ‘ ì½ê³ , ì§ì ‘ ì”ë‹ˆë‹¤.**
- ì¦‰, **ìºì‹œ ë©”ëª¨ë¦¬ë¥¼ ìš°íšŒ**í•˜ì—¬ ë©”ëª¨ë¦¬ì˜ ìµœì‹  ê°’ì„ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



**ì‹¤í–‰ íë¦„ ë¹„êµ**

| í•­ëª©                         | `volatile` ë¯¸ì ìš©           | `volatile` ì ìš©                       |
| ---------------------------- | --------------------------- | ------------------------------------- |
| main ìŠ¤ë ˆë“œì—ì„œ falseë¡œ ì„¤ì • | ìºì‹œì—ë§Œ ë°˜ì˜               | ë©”ì¸ ë©”ëª¨ë¦¬ì— ì¦‰ì‹œ ë°˜ì˜               |
| work ìŠ¤ë ˆë“œì—ì„œ ì½ê¸°         | ì˜¤ë˜ëœ ê°’(`true`) ê³„ì† ì½ìŒ | ë©”ì¸ ë©”ëª¨ë¦¬ì—ì„œ ìµœì‹  ê°’(`false`) ì½ìŒ |
| ê²°ê³¼                         | ë¬´í•œ ë£¨í”„ â†’ ì¢…ë£Œë˜ì§€ ì•ŠìŒ   | ì¦‰ì‹œ while íƒˆì¶œ â†’ ì •ìƒ ì¢…ë£Œ           |



**ì‹¤í–‰ ê²°ê³¼ ë¹„êµ**

**ë¯¸ì ìš©**

```vb
main: runFlag = false
work: ê³„ì† true ì½ìŒ
â†’ task ì¢…ë£Œë˜ì§€ ì•ŠìŒ
```

**ì ìš©**

```vb
main: runFlag = false
work: false ì¸ì‹ â†’ "task ì¢…ë£Œ"
â†’ í”„ë¡œê·¸ë¨ ì •ìƒ ì¢…ë£Œ
```



**ìš”ì•½**

| í‚¤ì›Œë“œ          | ì—­í•                                       |
| --------------- | ----------------------------------------- |
| `volatile`      | ê°’ì„ ì½ê³  ì“¸ ë•Œ **í•­ìƒ ë©”ì¸ ë©”ëª¨ë¦¬ ì‚¬ìš©** |
| `synchronized`  | ì„ê³„ ì˜ì—­ ë³´í˜¸ + ê°€ì‹œì„± ë³´ì¥              |
| `ReentrantLock` | ë½ ê¸°ë°˜ ë™ê¸°í™” + ê°€ì‹œì„± ë³´ì¥              |

`volatile`ì€ **ê°„ë‹¨í•œ í”Œë˜ê·¸ë‚˜ ìƒíƒœê°’ ë™ê¸°í™”ì— ì í•©**, í•˜ì§€ë§Œ **ë³µí•© ì—°ì‚° ë³´í˜¸ì—ëŠ” ë¶€ì ì ˆí•©ë‹ˆë‹¤.**



## 3. ì‹¤ì‹œê°„ ì˜ˆì œì—ì„œ ë“œëŸ¬ë‚˜ëŠ” ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œ (`count` & `flag`)

**ì‹¤í—˜ ì½”ë“œ ìš”ì•½ (volatile ë¯¸ì ìš©)**

```java
boolean flag = true;
long count = 0;

while (flag) {
    count++;
    if (count % 100_000_000 == 0) {
        log("flag = " + flag + ", count = " + count);
    }
}
```

- `main` ìŠ¤ë ˆë“œëŠ” 1ì´ˆ í›„ `flag = false` ì„¤ì •í•©ë‹ˆë‹¤.
- `work` ìŠ¤ë ˆë“œëŠ” `flag`ê°€ falseê°€ ë˜ë©´ ë£¨í”„ë¥¼ ë¹ ì ¸ë‚˜ê°€ì•¼ í•©ë‹ˆë‹¤.



**ê²°ê³¼ ë¶„ì„ (volatile ë¯¸ì ìš©)**

- `main`ì€ `flag = false`ë¥¼ ì„¤ì •í–ˆì§€ë§Œ
- `work`ëŠ” í•œì°¸ í›„ì—ì„œì•¼ `flag`ê°€ falseì¸ ê±¸ ì¸ì‹
- ì¢…ë£Œ ì‹œì ì— `count`ëŠ” ì•½ **12ì–µ**

ì´ ì‹œì ì— ì½˜ì†” ì¶œë ¥ì´ ìˆì–´ì„œ **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­**ì´ ë°œìƒ â†’ ìºì‹œ ê°±ì‹  â†’ `flag = false` ê°ì§€



**ë¬¸ì œ í•µì‹¬**

- `work` ìŠ¤ë ˆë“œëŠ” ìì‹ ì˜ ìºì‹œ ë©”ëª¨ë¦¬ì— ìˆëŠ” `flag` ê°’(true)ì„ ê³„ì† ì½ìŠµë‹ˆë‹¤.
- `main`ì´ ë°”ê¾¼ `flag = false`ëŠ” **ìºì‹œì— ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
- ìºì‹œ ë™ê¸°í™”ëŠ” ì˜ˆì¸¡ ë¶ˆê°€: ì–¸ì œ, í˜¹ì€ **ì˜ì›íˆ ì•ˆ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.**



**í•´ê²°: `volatile` ì ìš©**

``` java
volatile boolean flag = true;
volatile long count = 0;
```

- `flag`ì™€ `count`ë¥¼ ëª¨ë‘ ë©”ì¸ ë©”ëª¨ë¦¬ì—ì„œ ì½ê³  ì”ë‹ˆë‹¤.
- `main`ì´ ì„¤ì •í•œ ê°’ì´ ì¦‰ì‹œ `work`ì—ì„œ ë³´ì…ë‹ˆë‹¤.



**ê²°ê³¼ ë¶„ì„ (volatile ì ìš©)**

- `flag` ë³€ê²½ í›„ **ì¦‰ì‹œ ê°ì§€ë©ë‹ˆë‹¤.**
- `count`ê°€ **ì•½ 2.2ì–µ**ì—ì„œ ì¢…ë£Œë¨ â†’ ë¯¸ì ìš©ë³´ë‹¤ 5ë°° ì´ìƒ ë¹ ë¥¸ ì¢…ë£Œ



**ì‹¤í–‰ ì„±ëŠ¥ ì°¨ì´ ë¹„êµ**

| í•­ëª©                | volatile ë¯¸ì ìš© | volatile ì ìš© |
| ------------------- | --------------- | ------------- |
| count ì¢…ë£Œ ì‹œì      | ì•½ 12ì–µ         | ì•½ 2.2ì–µ      |
| flag ë³€ê²½ ê°ì§€ ì‹œì  | ëŠë¦¼ (ëœë¤)     | ë¹ ë¦„ (ì¦‰ì‹œ)   |
| ì¢…ë£Œ ë°˜ì‘ì„±         | ë§¤ìš° ë‚®ìŒ       | ë†’ìŒ          |

**ë‹¨ì **: `volatile` ì‚¬ìš© ì‹œ ì„±ëŠ¥ì€ ì•½ê°„ ì €í•˜ë©ë‹ˆë‹¤. (í•­ìƒ ë©”ì¸ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë¯€ë¡œ)



**ê²°ë¡ **

- ì‹¤ì‹œê°„ ë°˜ì‘ì´ ì¤‘ìš”í•œ ìƒíƒœ ë™ê¸°í™”ì—ëŠ” **`volatile`ì´ ë§¤ìš° íš¨ê³¼ì **ì…ë‹ˆë‹¤.
- í•˜ì§€ë§Œ ë³µí•© ì—°ì‚°(ex: `count++`)ì´ **ì›ìì ì´ì§€ ì•Šìœ¼ë¯€ë¡œ**, ë™ê¸°í™”ê°€ í•„ìš”í•œ ê²½ìš°ì—” `synchronized`ë‚˜ `AtomicLong`ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.



## 4. ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ (Java Memory Model, JMM)ê³¼ `happens-before` ê·œì¹™



 **1) ë©”ëª¨ë¦¬ ê°€ì‹œì„±ì˜ ì •ì˜**

**Memory Visibility (ë©”ëª¨ë¦¬ ê°€ì‹œì„±)**: í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ë³€ê²½í•œ ë©”ëª¨ë¦¬ ê°’ì´ **ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ê²Œ ì–¸ì œ ë³´ì´ëŠ”ì§€**ë¥¼ ë‹¤ë£¨ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.
ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œëŠ” ê° ìŠ¤ë ˆë“œê°€ **ìì‹ ë§Œì˜ CPU ìºì‹œ**ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, **ê°’ì„ ë³€ê²½í•´ë„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì¦‰ì‹œ ê·¸ ë³€í™”ë¥¼ ê°ì§€í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**



**2) Java Memory Model (JMM)ì´ë€?**

- ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ **ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì¼ê´€ì„± ìˆëŠ” ë™ì‘ì„ ë³´ì¥**í•˜ê¸° ìœ„í•œ ëª…ì„¸ì…ë‹ˆë‹¤.
- í•µì‹¬ ê°œë…: **happens-before ê´€ê³„**



**3) happens-beforeë€?**

â€œA ì‘ì—…ì´ B ì‘ì—…ë³´ë‹¤ ë¨¼ì € ë°œìƒí•œ ê²ƒì´ ë³´ì¥ë˜ë©´, AëŠ” Bë³´ë‹¤ happens-before ê´€ê³„ì— ìˆë‹¤.â€

- **Aì—ì„œì˜ ë©”ëª¨ë¦¬ ë³€ê²½ ë‚´ìš©ì€ Bê°€ ë°˜ë“œì‹œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
- ì¦‰, **A ì‘ì—…ì´ ì™„ë£Œëœ í›„ Bê°€ ì‹¤í–‰ë˜ë©°, ë³€ê²½ ë‚´ìš©ì„ ì¸ì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.**



**happens-before ê´€ê³„ ì˜ˆì‹œ**

| ìƒí™©                                                 | ì„¤ëª…                                                         |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| **ë™ì¼ ìŠ¤ë ˆë“œ ë‚´ ì½”ë“œ ìˆœì„œ**                         | ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ëœ ì½”ë“œë“¤ì€ ì•ì„  ì½”ë“œê°€ ë’¤ì˜ ì½”ë“œë³´ë‹¤ happens-before |
| **`volatile` ë³€ìˆ˜ ì“°ê¸° â†’ ì½ê¸°**                      | `volatile`ë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ì— ì“°ê¸° â†’ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì½ê¸°: happens-before |
| **`Thread.start()` í˜¸ì¶œ â†’ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œì˜ ì‹¤í–‰**     | `start()` í˜¸ì¶œ ì´ì „ ì‘ì—… â†’ ìƒˆ ìŠ¤ë ˆë“œì˜ `run()` ë‚´ìš©ë³´ë‹¤ ë¨¼ì € ë°œìƒ |
| **`Thread.join()` í˜¸ì¶œ â†’ join ì´í›„ ì½”ë“œ**            | ëŒ€ìƒ ìŠ¤ë ˆë“œì˜ ëª¨ë“  ì‘ì—… â†’ `join()` ë°˜í™˜ í›„ì˜ ì‘ì—…ë³´ë‹¤ ë¨¼ì € ë°œìƒ |
| **`synchronized` ë¸”ë¡ ì¢…ë£Œ â†’ ë‹¤ìŒ ìŠ¤ë ˆë“œì˜ ì§„ì…**    | ë½ì„ í•´ì œí•œ í›„ â†’ ê·¸ ë½ì„ íšë“í•œ ìŠ¤ë ˆë“œì˜ ì‘ì—…ë³´ë‹¤ ë¨¼ì € ë°œìƒ  |
| **`ReentrantLock.unlock()` â†’ `lock()` íšë“ í›„ ì‘ì—…** | ë½ í•´ì œ í›„ ë½ì„ íšë“í•œ ìŠ¤ë ˆë“œì˜ ì‘ì—…ë³´ë‹¤ ë¨¼ì € ë°œìƒ           |



**4) happens-beforeì˜ ì „ì´ ê·œì¹™**

- ë§Œì•½ A â†’ B, B â†’ Cê°€ happens-before ê´€ê³„ë¼ë©´, A â†’ C ì—­ì‹œ **happens-before**ê°€ ì„±ë¦½í•©ë‹ˆë‹¤.



**5) ìš”ì•½ ì •ë¦¬**

ğŸ” **`volatile`, `synchronized`, `ReentrantLock`** ê°™ì€ **ë™ê¸°í™” ë„êµ¬**ë¥¼ ì‚¬ìš©í•˜ë©´ **happens-before ê´€ê³„ê°€ ì„±ë¦½ë˜ê³ , ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**



## 5. **`happens-before` ê´€ê³„ ì˜ˆì‹œ ìƒì„¸ ì„¤ëª…**

**ë™ì¼ ìŠ¤ë ˆë“œ ë‚´ ì½”ë“œ ìˆœì„œ**

**ìƒí™©**: ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ëœ ì½”ë“œë“¤ì€ ì•ì„  ì½”ë“œê°€ ë’¤ì˜ ì½”ë“œë³´ë‹¤ happens-before

```java
int a = 1;         // A
int b = a + 1;     // B
```

- `A`ëŠ” `B`ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë¨ì´ **ëª…í™•íˆ ë³´ì¥ë©ë‹ˆë‹¤.**
- ë”°ë¼ì„œ Aì˜ ë©”ëª¨ë¦¬ ë³€ê²½ ì‚¬í•­ì€ Bì—ì„œ **ë°˜ë“œì‹œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
- ë‹¨ì¼ ìŠ¤ë ˆë“œ ë‚´ë¶€ì—ì„œëŠ” **ì»´íŒŒì¼ëŸ¬ë‚˜ CPUë„ ëª…ë ¹ ìˆœì„œë¥¼ ë°”ê¾¸ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ê²°ë¡ : **ë³´ì¥ë©ë‹ˆë‹¤.**



**`volatile` ë³€ìˆ˜ ì“°ê¸° â†’ ì½ê¸°**

**ìƒí™©**: í•œ ìŠ¤ë ˆë“œì—ì„œ `volatile` ë³€ìˆ˜ì— ì“°ê¸° â†’ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì½ê¸°: happens-before

```java
volatile boolean flag = false;

// ìŠ¤ë ˆë“œ A
flag = true; // ì“°ê¸°

// ìŠ¤ë ˆë“œ B
if (flag) { // ì½ê¸°
    // ì—¬ê¸°ëŠ” ë°˜ë“œì‹œ trueê°€ ë³´ì¥ë¨
}
```

- **`volatile`ì€ ë©”ëª¨ë¦¬ ê°€ì‹œì„±ì„ ë³´ì¥**í•˜ê¸° ë•Œë¬¸ì— A ìŠ¤ë ˆë“œê°€ `true`ë¡œ ë°”ê¾¸ë©´, B ìŠ¤ë ˆë“œëŠ” ë°˜ë“œì‹œ **ë³€ê²½ëœ ê°’ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
- ì—¬ê¸°ì„œ `flag = true`ëŠ” `if (flag)`ë³´ë‹¤ **happens-before**

ê²°ë¡ : **ê°€ì‹œì„±ê³¼ ìˆœì„œ ë³´ì¥**ë©ë‹ˆë‹¤.



**`Thread.start()` í˜¸ì¶œ â†’ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œì˜ ì‹¤í–‰**

**ìƒí™©**: `start()` í˜¸ì¶œ ì´ì „ ì‘ì—… â†’ ìƒˆ ìŠ¤ë ˆë“œì˜ `run()`ë³´ë‹¤ happens-before 

```java
int a = 0;

Thread t = new Thread(() -> {
    System.out.println(a); // ì´ ì‹œì ì—” aì˜ ê°’ì´ ë°˜ë“œì‹œ 42
});

a = 42;
t.start(); // t.run()ì€ ì´í›„ ì‹¤í–‰ë¨
```

- `a = 42`ëŠ” `t.start()` ì´ì „ ì‘ì—…ì…ë‹ˆë‹¤.
- ë”°ë¼ì„œ tì˜ `run()` ë‚´ë¶€ì—ì„œëŠ” `a == 42`ê°€ ë³´ì¥ë©ë‹ˆë‹¤.

ê²°ë¡ : **ìŠ¤ë ˆë“œ ì‹œì‘ ì „ ì‘ì—… â†’ run() ë‚´ë¶€ ì½”ë“œë³´ë‹¤ ë¨¼ì € ë°œìƒ**í•©ë‹ˆë‹¤.



**`Thread.join()` í˜¸ì¶œ â†’ join ì´í›„ ì½”ë“œ**

ìƒí™©: ëŒ€ìƒ ìŠ¤ë ˆë“œì˜ ëª¨ë“  ì‘ì—… â†’ `join()` ë°˜í™˜ í›„ì˜ ì‘ì—…ë³´ë‹¤ happens-before

```java
Thread t = new Thread(() -> {
    result = 10; // ìŠ¤ë ˆë“œ tì˜ ì‘ì—…
});
t.start();
t.join(); // ëŒ€ê¸°

System.out.println(result); // result == 10 ì´ ë³´ì¥ë¨
```

- `t.join()`ì´ ë°˜í™˜ë˜ë©´, ìŠ¤ë ˆë“œ tì˜ ì‘ì—…ì€ **ëª¨ë‘ ì™„ë£Œëœ ìƒíƒœ**ì…ë‹ˆë‹¤.
- `result = 10` â†’ `System.out.println(result)`ê°€ **happens-before ê´€ê³„**

ê²°ë¡ : **join ì´í›„ì˜ ì½”ë“œëŠ” ì•ˆì „í•˜ê²Œ ê²°ê³¼ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**



**`synchronized` ë¸”ë¡ ì¢…ë£Œ â†’ ë‹¤ìŒ ìŠ¤ë ˆë“œì˜ ì§„ì…**

**ìƒí™©**: ë½ì„ í•´ì œí•œ í›„ â†’ ê·¸ ë½ì„ íšë“í•œ ìŠ¤ë ˆë“œì˜ ì‘ì—…ë³´ë‹¤ happens-before 

```java
synchronized(lock) {
    sharedValue = 5;
} // A ìŠ¤ë ˆë“œ ë½ í•´ì œ

// B ìŠ¤ë ˆë“œ
synchronized(lock) {
    System.out.println(sharedValue); // ë°˜ë“œì‹œ 5 ì¶œë ¥
}
```

- A ìŠ¤ë ˆë“œê°€ ë½ì„ í•´ì œí•œ í›„ â†’ B ìŠ¤ë ˆë“œê°€ ê°™ì€ ë½ì„ íšë“í•˜ë©´
- Aì˜ synchronized ë¸”ë¡ ë‚´ì˜ ì‘ì—…ì€ Bì˜ ë¸”ë¡ ë‚´ ì‘ì—…ë³´ë‹¤ **ë¨¼ì € ë°œìƒí•©ë‹ˆë‹¤.**

ê²°ë¡ : **ë½ í•´ì œ â†’ ë‹¤ìŒ ìŠ¤ë ˆë“œ ì§„ì… ì‹œì  ì‚¬ì´ì— happens-beforeê°€ ì„±ë¦½ë¨**



**`ReentrantLock.unlock()` â†’ `lock()` íšë“ í›„ ì‘ì—…**

**ìƒí™©**: ë½ í•´ì œ í›„ ë½ì„ íšë“í•œ ìŠ¤ë ˆë“œì˜ ì‘ì—…ë³´ë‹¤ happens-before |

```java
ReentrantLock lock = new ReentrantLock();

// A ìŠ¤ë ˆë“œ
lock.lock();
sharedValue = 100;
lock.unlock(); // Aì˜ ì‘ì—… ì¢…ë£Œ

// B ìŠ¤ë ˆë“œ
lock.lock();
System.out.println(sharedValue); // 100 ë³´ì¥
lock.unlock();
```

- `ReentrantLock`ë„ ë½ ê¸°ë°˜ ë™ê¸°í™”ì´ë¯€ë¡œ `synchronized`ì™€ ë™ì¼í•œ happens-before ê´€ê³„ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
- ë½ì„ í•´ì œí•œ í›„, ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ê°™ì€ ë½ì„ íšë“í•˜ë©´ ê·¸ ì „ì— ì‹¤í–‰ëœ ë‚´ìš©ì´ **ê°€ì‹œì„± ìˆê²Œ ë³´ì¥ë©ë‹ˆë‹¤.**

ê²°ë¡ : **lock/unlockì„ ì‚¬ìš©í•œ ëª…ì‹œì  ë™ê¸°í™”ë„ ìˆœì„œ ë³´ì¥**



**ì •ë¦¬**

| ë™ê¸°í™” ë°©ì‹                     | happens-before ë³´ì¥ ì—¬ë¶€ |
| ------------------------------- | ------------------------ |
| ë™ì¼ ìŠ¤ë ˆë“œ ë‚´ ìˆœì°¨ ì‹¤í–‰        | âœ… ë³´ì¥ë¨                 |
| `volatile` ì½ê¸°/ì“°ê¸°            | âœ… ë³´ì¥ë¨                 |
| `Thread.start()`, `join()`      | âœ… ë³´ì¥ë¨                 |
| `synchronized`, `ReentrantLock` | âœ… ë³´ì¥ë¨                 |

**í•µì‹¬ ìš”ì•½:** **ë™ê¸°í™” ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ happens-before ê´€ê³„ê°€ ìƒê¸°ê³ , ë©”ëª¨ë¦¬ ê°€ì‹œì„± ë¬¸ì œê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.**